# 使用虚幻引擎（UE5）把本后端规则做成第一人称独立游戏：零基础工作流

这份说明面向**零基础小白**，目标是把当前仓库的“纯后端规则”（高度/氧气/温度/紧张度/装备/怪物/箭矢/胜负）落地成一个 UE5 的**第一人称**可玩的独立游戏。

> 你不需要一次做完所有内容。按下面的步骤从“能跑起来”到“逐步变好”即可。

---

## 你将做出什么（最终形态）

- 第一人称角色（WASD/鼠标）在场景中移动
- 游戏规则每帧更新：
  - 高度随时间上升（或改成随上升平台/飞行器/电梯等表现）
  - 氧气/温度随高度变化，装备提供加成
  - 紧张度受威胁/恶劣环境影响上升，影响耗氧与行动
  - 怪物生成并移动，靠近或碰撞触发失败
  - 玩家可射击命中怪物获得金币，金币用于购买装备
  - 达成条件胜利
- UI 显示高度/氧气/温度/紧张度/金币/装备与警告弹窗

---

## 0. 准备（一次性）

### 安装
- **Epic Games Launcher**（启动器）
- 在启动器里安装 **Unreal Engine 5.x**（建议 5.3 或更高）
- 安装 **Visual Studio 2022**（Community 版即可）
  - 勾选：**使用 C++ 的桌面开发**
  - 勾选：**Windows 10/11 SDK**

### 建议的学习顺序（非常重要）
- 先只用**蓝图（Blueprint）**把流程走通
- 再把“规则核心”迁移到 C++（更稳定/更可控）

---

## 1. 创建工程（第一天就能完成）

1. 打开 UE → 点击**游戏（Games）** → 选择 **第一人称（First Person）** 模板  
2. 选择 **蓝图（Blueprint）** 或 **C++**：
   - **零基础建议先选蓝图**（后面仍可以加 C++）
3. 勾选 **初学者内容包（Starter Content）**（方便快速有素材）
4. 创建项目并运行一次，确保第一人称能正常走动和开火

你现在已经拥有：
- 一个 `FirstPersonCharacter`（第一人称角色）
- 一个简单的“发射物/射击”示例

---

## 2. 把“后端规则”搬进 UE：推荐的类拆分（核心思路）

你现在仓库里的 `Game` 类相当于“规则服务器”。在 UE 里建议这样拆：

### 规则数据（强烈推荐放在 PlayerState 或组件里）
- **玩家生存属性**：高度、氧气、温度、紧张度、金币、装备  
放在：
- 方案 A（新手友好）：`UActorComponent`（比如 `UPlayerVitalsComponent`），挂在角色身上
- 方案 B（更标准/多人也方便）：`APlayerState`

### 规则驱动（每帧 tick 的地方）
- 方案 A：`GameMode` 每帧 Tick 调 `VitalsComponent->TickRules(DeltaSeconds)`
- 方案 B：在 `VitalsComponent` 自己 Tick

### 怪物系统
- `AMonsterActor`：怪物的移动（下落/摆动/追踪都行）
- `ASpawner` 或 `GameMode`：定时生成怪物（根据高度/难度）

### 弓箭/子弹
复用第一人称模板的**投射物（Projectile）**，命中怪物时给金币并销毁怪物。

---

## 3. 从“秒懂能做”开始：先做 UI（你能立刻看到进度）

### 步骤（中文版 UE 界面）

1. 在**内容浏览器（Content Browser）**中：
   - 右键空白处 → **用户界面（User Interface）** → **控件蓝图（Widget Blueprint）**
   - 命名为 `WBP_HUD`（HUD = 平视显示器）

2. 双击打开 `WBP_HUD`，在**控件面板（Palette）**中：
   - 拖入 **文本（Text）** 控件
   - 创建多个文本显示：
     - 高度（Height）
     - 氧气（Oxygen）
     - 温度（Temperature）
     - 紧张度（Stress）
     - 金币（Coins）
     - 装备（Equipment）

### 详细操作：创建多个文本控件

**方法一：从控制板拖入（推荐）**
1. 在左侧**控制板（Palette）**中找到 **文本（Text）**（在"通用"分类下）
2. 用鼠标**拖拽**到画布（Canvas）上，松开鼠标
3. 重复步骤 2，创建 6 个文本控件（或更多，根据需要）

**方法二：复制现有文本（更快）**
1. 选中画布上已有的文本控件（比如你刚创建的 "Height"）
2. 按 `Ctrl + C` 复制，然后按 `Ctrl + V` 粘贴
3. 重复粘贴，创建多个文本控件

**⚠️ 如果无法拖拽或复制粘贴，请检查以下几点：**

1. **确保选中了正确的父容器**：
   - 在左侧**层级（Hierarchy）**面板中，点击根节点 `[WBP_HUD]`（或 `Canvas Panel`）
   - 确保画布（Canvas）是选中的，而不是某个文本控件
   - 然后再尝试从控制板拖拽文本

2. **取消当前选择**：
   - 点击画布的空白区域（灰色网格区域，不是文本控件上）
   - 或者按 `Esc` 键取消选择
   - 然后再尝试拖拽或复制粘贴

3. **检查画布是否被锁定**：
   - 查看画布上方工具栏，确保没有锁定图标被激活
   - 如果有锁定，点击解锁

4. **如果还是不行，尝试这个方法**：
   - 在左侧**层级（Hierarchy）**面板中，右键点击根节点 `[WBP_HUD]` 或 `Canvas Panel`
   - 选择 **添加控件（Add Widget）** → **文本（Text）**
   - 这样可以直接在层级中创建，然后到画布上调整位置

**接下来：设置每个文本的内容和位置**

1. **修改文本内容**：
   - 选中一个文本控件
   - 在右侧**细节（Details）**面板 → **内容（Content）** → **文本（Text）**
   - 输入对应的标签，比如：
     - 第一个：`高度: 0m`
     - 第二个：`氧气: 100%`
     - 第三个：`温度: 20°C`
     - 第四个：`紧张度: 0%`
     - 第五个：`金币: 0`
     - 第六个：`装备: 草裙`

2. **调整位置**：
   - 用鼠标**拖拽**文本控件到合适位置（比如左上角，垂直排列）
   - 或者选中后在**细节（Details）**面板 → **插槽（Slot）** → 设置**位置 X** 和**位置 Y**

3. **给每个文本命名（重要！后续绑定数据要用）**：
   - 选中文本控件
   - 在**细节（Details）**面板顶部，勾选 **是变量（Is Variable）**
   - 在**层级（Hierarchy）**面板中，右键文本控件 → **重命名（Rename）**
   - 建议命名：
     - `Text_Height`（高度文本）
     - `Text_Oxygen`（氧气文本）
     - `Text_Temperature`（温度文本）
     - `Text_Stress`（紧张度文本）
     - `Text_Coins`（金币文本）
     - `Text_Equipment`（装备文本）

4. **调整字体大小和样式**（可选）：
   - 选中文本控件
   - **细节（Details）** → **字体（Font）** → **尺寸（Size）**（比如改成 24 或 32，根据你的屏幕大小调整）

3. 在 `FirstPersonCharacter` 的**开始游戏时（BeginPlay）**事件：
   - 创建控件（Create Widget）→ 选择 `WBP_HUD`
   - 添加到视口（Add to Viewport）

4. 每帧从你的 Vitals 数据源读取并更新文本（在**事件 Tick** 或**定时器**中）

> 小白提示：UI 做出来后，你就能直观看到规则在工作，这会极大减少迷茫。

---

## 4. 把当前 C++ 规则“翻译”成 UE 版本（建议先 1:1，再改表现）

你当前规则的关键点：
- 环境：高度 → 氧气/温度（分段函数）
- 装备加成：不同装备给不同氧气/温度加成
- 警告逻辑：温度优先于氧气
- 死亡：氧气<10 或 温度<-30 或 碰撞怪物
- 胜利：穿宇航服且高度>15000
- 紧张度：受怪物距离/低氧/低温/warning 影响；紧张度增加耗氧并轻微降速

### UE 里用 DeltaSeconds 做“真实时间”

当前后端假设 60fps，每 tick 高度 +0.8。  
UE 推荐用：
- `Height += RiseSpeedPerSecond * DeltaSeconds`
并设置：
- `RiseSpeedPerSecond = 0.8 * 60 = 48.0 (m/s)`  
这样无论帧率多少，效果一致。

---

## 5. 怪物生成与移动：先做“简单但可玩”

### 最简单可玩版
- 每隔 X 秒生成 1 只怪
- 出生点在玩家前方一定距离 + 随机偏移
- 怪物向玩家移动（比“屏幕下落”更贴近第一人称）

### 如何保持“符合你原规则”的味道
你原来是“从上方落下 + 左右摆动”。第一人称里可以替换为：
- “从远处出现并靠近”
- 或 “从上方掉落到你附近”
**规则不变**，只是“表现形式”更适合 3D/第一人称。

---

## 6. 装备购买：最适合新手的实现

### 数据化（强烈建议）

创建一个**数据表（DataTable）**（或**主数据资产（Primary Data Asset）**）保存装备：
- ID（coat/oxygenMask/...）
- 价格（Price）
- 氧气加成（OxygenBonus）
- 温度加成（TempBonus）
- 下一个ID（NextID，保证顺序购买）

**操作步骤（中文版）**：
1. 内容浏览器 → 右键 → **杂项（Miscellaneous）** → **数据表（Data Table）**
2. 选择行结构（Row Structure），如果没有就先创建一个**结构体（Struct）**
3. 在数据表中填入每个装备的数据

### UI 操作
在 `WBP_HUD` 加 4 个**按钮（Button）**或一个商店面板：
- 点击购买 → 调用角色/组件里的 `TryBuyEquipment(EquipID)`
- 成功则更新装备与金币
- 不够钱给提示（用**文本（Text）**显示提示信息）

---

## 7. 碰撞与伤害：用 UE 自带机制就够

建议怪物用**胶囊体（Capsule）** 或 **球体（Sphere）** 碰撞。

- 玩家与怪物**重叠（Overlap）** → 触发游戏结束（GameOver）
- 子弹命中怪物（**命中（Hit）**/**重叠（Overlap）**） → 怪物销毁、金币增加

**在蓝图中设置**：
- 选中怪物 Actor → **细节（Details）**面板 → **碰撞（Collision）**
- 设置**碰撞预设（Collision Preset）**为“重叠所有（OverlapAll）”或自定义
- 在**事件图表（Event Graph）**中添加**事件重叠（Event OnActorBeginOverlap）**节点

---

## 8. 推荐的“从小到大”里程碑（照着做不迷路）

### 里程碑 A（1 天）
- 第一人称模板跑通
- HUD 显示 高度/氧气/温度/紧张度/金币
- 每秒高度增加，UI 数字变化

### 里程碑 B（2~3 天）
- 把环境函数与死亡/胜利规则接上
- UI 出现 **警告（Warning）** / **游戏结束（GameOver）** / **胜利（Victory）**

### 里程碑 C（1 周）
- 怪物生成 + 碰撞死亡
- 射击击杀加金币

### 里程碑 D（1~2 周）
- 装备商店与顺序购买
- 紧张度与耗氧/降速效果“能感受到”

### 里程碑 E（之后再做）
- 美术、音效、关卡、存档、难度曲线、打包发布

---

## 9. 调试技巧（新手必看）

- 给关键变量打日志（UE_LOG）或在蓝图里用**打印字符串（Print String）**节点
- 做一个“调试面板”：一键加金币、一键切装备、一键生成怪物
- 先把数值调得夸张一点（更容易看出效果），确认逻辑正确后再调回合理范围

**在蓝图中打印调试信息**：
- 拖入**打印字符串（Print String）**节点
- 连接要显示的变量到**输入（In String）**
- 运行游戏时会在**输出日志（Output Log）**中显示

---

## 10. 如何复用本仓库 C++ 代码（可选）

你有两条路：

### 路线 1（推荐新手）：把规则“照着抄”到 UE 类里
优点：UE 生态更顺，和蓝图/UI/网络更好接。  
缺点：需要把逻辑再实现一遍（但也正好学习）。

### 路线 2：把当前 `Game` 类当成纯逻辑库塞进 UE
做法：
- 把 `src/game.hpp/.cpp` 复制到 UE 项目的 `Source/<ProjectName>/` 下
- 用一个 UE 的组件包装：`UGameRulesAdapterComponent`
- 每帧调用 `Game.tick(...)`，再把 snapshot 同步到 UI

新手建议先走路线 1，等你熟悉后再考虑路线 2。

---

## 11. 常见中文版 UE 界面术语对照（方便查找）

| 英文术语 | 中文版 UE 显示 |
|---------|--------------|
| Games | 游戏 |
| First Person | 第一人称 |
| Blueprint | 蓝图 |
| C++ | C++ |
| Starter Content | 初学者内容包 |
| Content Browser | 内容浏览器 |
| User Interface | 用户界面 |
| Widget Blueprint | 控件蓝图 |
| Text | 文本 |
| Button | 按钮 |
| BeginPlay | 开始游戏时 |
| Event Tick | 事件 Tick |
| Viewport | 视口 |
| DataTable | 数据表 |
| Primary Data Asset | 主数据资产 |
| Struct | 结构体 |
| Capsule | 胶囊体 |
| Sphere | 球体 |
| Collision | 碰撞 |
| Collision Preset | 碰撞预设 |
| Overlap | 重叠 |
| Hit | 命中 |
| Event OnActorBeginOverlap | 事件 开始重叠 |
| Event Graph | 事件图表 |
| Details | 细节 |
| Print String | 打印字符串 |
| Output Log | 输出日志 |
| GameMode | 游戏模式 |
| PlayerState | 玩家状态 |
| Actor Component | Actor 组件 |

---

## 12. 你需要我下一步帮你做什么（你选一种）

1. **给你一套 UE5 的 C++ 类骨架**（GameMode/Character/Monster/VitalsComponent/HUD Widget 对应接口），你复制进 UE 就能编译  
2. **把紧张度/氧气/温度/装备做成数据表 + UI 商店**的具体蓝图步骤（逐图说明）  
3. 你想要的“第一视角表现”是什么：上升电梯/喷气背包/热气球/飞船？我帮你把“高度上升”与关卡表现对齐
